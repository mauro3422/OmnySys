# CHANGELOG - OmnySys

## [0.1.0] - 2026-01-31

### Added - Phase 1: Layer A - Static Analysis (COMPLETE ✓)

#### Core Components

1. **scanner.js** (156 lines)
   - Discovers all project files matching supported extensions
   - Handles TypeScript, JSX, and standard JS files
   - Returns project-relative paths with forward slashes (Windows compatible)
   - Excludes node_modules, .git, dist, build, etc.

2. **parser.js** (232 lines)
   - Parses individual files using @babel/parser AST generation
   - Extracts:
     - **Imports**: ES6 modules and CommonJS requires with source info
     - **Exports**: Named, default, and declaration exports
     - **Definitions**: Function and class declarations
     - **Calls**: All function calls at file level
   - Handles JSX, TypeScript, Flow, async/await, optional chaining, etc.

3. **resolver.js** (254 lines)
   - Converts relative imports to project-relative absolute paths
   - Features:
     - Relative path resolution (`./utils` → `src/utils.js`)
     - Alias resolution (tsconfig.json / jsconfig.json support)
     - External module detection (node_modules, npm packages)
     - File extension resolution (`.js`, `.ts`, `.tsx`, `.jsx`, etc.)
     - Index file detection (`import from './dir'` → `./dir/index.js`)
   - Returns standardized `{ resolved, type, reason }` format

4. **graph-builder.js** (334 lines)
   - Constructs complete dependency graph from parsed files
   - Builds bidirectional relationships:
     - `dependsOn`: Files this file imports from
     - `usedBy`: Files that import this file
     - `transitiveDepends`: All indirect dependencies (recursive)
     - `transitiveDependents`: All files affected by this file
   - Features:
     - Circular dependency detection via DFS traversal
     - Transitive dependency calculation
     - Risk level calculation based on affected files
     - Impact assessment via `getImpactMap()` function

5. **indexer.js** (192 lines)
   - Orchestrates complete Layer A pipeline
   - 8-step process:
     1. Project detection (TypeScript/JavaScript)
     2. File scanning
     3. File parsing with AST
     4. Import resolution configuration
     5. Import resolution execution
     6. Path normalization (critical fix)
     7. Dependency graph construction
     8. Output serialization to JSON
   - CLI interface: `node src/layer-a-static/indexer.js /path/to/project [output-file]`

#### Key Features

- **Complete Dependency Analysis**
  - File-level import tracking
  - Symbol-level import tracking (what's imported, not just module)
  - Bidirectional graph (dependencies and dependents)
  - Transitive dependency calculation

- **Error Handling**
  - Graceful parsing errors (continues on syntax errors)
  - Unresolved import tracking
  - Path escape detection (imports outside project)

- **Output Format**
  - Standardized JSON system map
  - Normalized paths (project-relative, forward slashes)
  - Rich metadata about graph (file count, dependency count, cycles)

#### Path Normalization (Critical Architecture Decision)

The entire system normalizes to **project-relative, forward-slash paths**:
- Scanner returns: `src/fileA.js` (not absolute Windows paths)
- Parser stores: Keys as absolute, values as-is
- Resolver returns: Project-relative paths via `normalizeToProjectRelative()`
- Indexer Paso 6: Converts all keys to project-relative before graph-builder
- Graph-builder expects: All keys already project-relative

This ensures consistent graph construction across Windows/Unix systems.

#### Test Validation

**scenario-1-simple-import** (3 files: A→B→C)
- ✓ 3 files detected
- ✓ 2 direct dependencies found (A→B, B→C)
- ✓ Transitive dependencies correct (A depends on B and C transitively)
- ✓ Circular dependency detection: none detected ✓

#### Bug Fixes

1. **CLI Detection** (parser.js, scanner.js, indexer.js)
   - Issue: `import.meta.url` not reliable for ESM module detection
   - Fix: Changed to `process.argv[1].includes('filename.js')`

2. **Path Normalization** (resolver.js)
   - Issue: Resolver returning absolute Windows paths vs scanner's relative paths
   - Fix: Added `normalizeToProjectRelative()` function to ensure consistency

3. **Graph Construction** (indexer.js Paso 6)
   - Issue: 0 dependencies despite successful import resolution
   - Fix: Added path normalization step before graph-builder to ensure all paths match

#### Architecture Decisions

- **Babel for AST**: Chose Babel over alternatives for maximum JavaScript variant support
- **File-level first**: Start with file-level analysis before function-level (Phase 2)
- **JSON for storage**: Start with JSON, plan SQLite for Phase 3, vectorial DB later
- **Project-relative paths**: Consistent, portable, easy to understand

#### Future Phases

- **Phase 2**: Function-level tracking (currently in progress)
- **Phase 2.5**: AI Editor integration using function-level graph
- **Phase 3**: MCP Server (Model Context Protocol) for AI integration
- **Phase 4**: Semantic analysis (non-obvious dependencies, patterns)

#### Documentation

- README.md: User guide and quick start
- PHASE-2-PLAN.md: Detailed implementation plan for function-level tracking
- ARCHITECTURE.md: System design and component interaction