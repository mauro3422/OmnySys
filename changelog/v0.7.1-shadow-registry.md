# Changelog v0.7.1 - Shadow Registry & 4 Metadata Extractors

**Fecha**: 2026-02-09  
**Estado**: Production Ready  
**Scope**: Shadow Registry System + 4 New Metadata Extractors  

---

## üéØ Resumen

Implementaci√≥n del **Shadow Registry** para preservar metadata de archivos eliminados y **4 nuevos extractores de metadata** que enriquecen el an√°lisis at√≥mico.

---

## üìä M√©tricas

| M√©trica | Antes | Despu√©s | Mejora |
|---------|-------|---------|--------|
| Metadata Extractors | 6 | 10 | **+4** |
| Shadow Registry | 0 | 7 shadows | **Nuevo** |
| Connection Types | 4 | 8 | **+4** |
| Connection Enricher | 0 | 1 | **Nuevo** |

---

## üóÇÔ∏è Shadow Registry

### Prop√≥sito

Sistema que preserva metadata de archivos eliminados, permitiendo:
- **Linaje**: Rastrear la evoluci√≥n de c√≥digo a trav√©s de refactorizaciones
- **Ancestry**: Encontrar "antepasados" de nuevos archivos basado en DNA
- **Vibration Scoring**: Calcular la "vibraci√≥n" de conexiones hist√≥ricas
- **ML Training**: Datos hist√≥ricos para entrenar modelos de predicci√≥n

### Dual Storage Strategy

```
.omnysysdata/
‚îú‚îÄ‚îÄ files/           # HOT: Archivos actuales (r√°pido)
‚îú‚îÄ‚îÄ shadows/         # SHADOW: Archivos eliminados (hist√≥rico)
‚îî‚îÄ‚îÄ index.json       # √çndice de ambos
```

### Estructura de Shadow

```javascript
{
  shadowId: "shadow_abc123",
  originalId: "atom_xyz789",
  createdAt: "2026-02-09T14:00:00Z",
  reason: "deleted",  // deleted | renamed | refactored
  dna: {
    structuralHash: "sha256:...",
    patternHash: "sha256:...",
    flowType: "read-transform-persist",
    semanticFingerprint: "verb:process domain:data entity:file"
  },
  metadata: {
    filePath: "src/old/utils.js",
    name: "processData",
    complexity: 7,
    dataFlowSummary: { inputs: 2, outputs: 1, transformations: 3 }
  },
  lineage: {
    generation: 0,
    parent: null,
    children: ["shadow_def456"]
  },
  inheritance: {
    vibrationScore: 0.85,
    strongConnections: [...],
    clanMembership: "data-processors"
  }
}
```

### DNA Matching

Los nuevos archivos pueden encontrar sus antepasados:

```javascript
const similar = await shadowRegistry.findSimilar(newAtom.dna, 0.85);
// Resultado: [{ shadow, similarity: 0.92 }, ...]
```

### Estado

- ‚úÖ **7 shadows** creados desde archivos stale
- ‚úÖ **DNA extraction** funcional en pipeline
- ‚úÖ **Lineage tracking** implementado
- ‚úÖ **Ancestry enrichment** en ConnectionEnricher

---

## üî¨ 4 Nuevos Metadata Extractors

### 1. Temporal Connections

**Archivo**: `temporal-connections.js`

Extrae patrones de ejecuci√≥n temporal y orden de llamadas.

```javascript
{
  lifecycle: {
    hasInit: true,
    hasDestroy: false,
    hasBeforeMount: false,
    hasAfterMount: true
  },
  eventDriven: {
    listeners: ['click', 'submit'],
    emitters: ['dataLoaded', 'error'],
    handlers: [...]
  },
  asyncFlow: {
    usesPromises: true,
    usesAsyncAwait: true,
    usesCallbacks: false,
    parallelCalls: ['Promise.all([a, b])']
  }
}
```

### 2. Type Contracts

**Archivo**: `type-contracts.js`

Extrae y valida contratos de tipos desde JSDoc y c√≥digo.

```javascript
{
  jsdoc: {
    hasJSDoc: true,
    valid: true,
    paramTypes: [{ name: 'userId', type: 'string', required: true }],
    returnType: { type: 'Promise<User>', nullable: false }
  },
  runtime: {
    hasTypeGuards: true,
    hasValidation: true,
    validationType: 'zod'
  },
  compatibility: {
    score: 0.95,
    issues: []
  }
}
```

### 3. Error Flow

**Archivo**: `error-flow.js`

Mapea flujos de error y detecci√≥n de manejo.

```javascript
{
  throws: [
    { type: 'ValidationError', message: 'Invalid input', conditional: true },
    { type: 'NotFoundError', message: 'User not found', conditional: false }
  ],
  catches: [
    { type: 'ValidationError', handler: 'local', rethrows: false },
    { type: 'Error', handler: 'global', rethrows: true }
  ],
  unhandled: ['NotFoundError'],
  propagation: 'upstream'
}
```

### 4. Performance Impact

**Archivo**: `performance-impact.js`

Calcula impacto de rendimiento de funciones.

```javascript
{
  score: 7.5,
  level: 'high',
  factors: {
    nestedLoops: 2,
    blockingOps: ['fs.readFileSync', 'heavyComputation'],
    recursion: false,
    asyncOverhead: true
  },
  complexity: {
    cyclomatic: 12,
    cognitive: 8,
    halstead: { volume: 450, difficulty: 15 }
  }
}
```

---

## üîó Connection Enricher

Post-procesador que enriquece conexiones b√°sicas con pesos calculados, detecci√≥n de conflictos y datos de ancestros.

### Features

| Feature | Descripci√≥n |
|---------|-------------|
| Smart Weights | Peso calculado basado en tipo + confianza |
| Temporal Constraints | Orden de ejecuci√≥n detectado |
| Type Compatibility | Verificaci√≥n de compatibilidad de tipos |
| Error Propagation | Detecci√≥n de errores no manejados |
| Ancestry Data | Herencia desde Shadow Registry |

### 8 Tipos de Conexiones

1. Import/Export (static)
2. Semantic (events, storage)
3. Data Flow
4. Temporal (NEW)
5. Type Contracts (NEW)
6. Error Flow (NEW)
7. Performance Impact (NEW)
8. Inherited/Ancestry (NEW)

---

## üß¨ DNA Extractor

Fingerprint √∫nico por √°tomo (inmutable ante cambios de nombre).

```javascript
{
  structuralHash: "sha256:...",
  patternHash: "sha256:...",
  flowType: "read-transform-persist",
  operationSequence: [...],
  complexityScore: 5,
  semanticFingerprint: "verb:process domain:user entity:data",
  id: "dna_unique_id"
}
```

---

## üìÅ Archivos Nuevos

```
src/layer-a-static/extractors/metadata/
‚îú‚îÄ‚îÄ temporal-connections.js      # NUEVO
‚îú‚îÄ‚îÄ type-contracts.js            # NUEVO
‚îú‚îÄ‚îÄ error-flow.js                # NUEVO
‚îú‚îÄ‚îÄ performance-impact.js        # NUEVO
‚îî‚îÄ‚îÄ dna-extractor.js             # NUEVO

src/layer-c-memory/shadow-registry/
‚îú‚îÄ‚îÄ index.js                     # NUEVO
‚îú‚îÄ‚îÄ lineage-tracker.js           # NUEVO
‚îî‚îÄ‚îÄ types.js                     # NUEVO

src/layer-a-static/pipeline/enhancers/
‚îî‚îÄ‚îÄ connection-enricher.js       # NUEVO
```

---

## üîß Correcciones Aplicadas

1. **Type Contracts Regex**: Escapado de par√°metros en regex din√°mica
2. **Connection Enricher**: Variables no definidas en scope
3. **Module Resolution**: Imports de `utils/logger.js` corregidos

---

[‚Üê Volver a v0.7.1 Summary](./v0.7.1.md)
