# v0.9.34 - Cross-File Linkage & Call Detection Fix

## ğŸ› Bug Fixes

### 1. Call Detection Mejorado (call-graph.js)

**Problema:** Solo 22.3% de atoms tenÃ­an `calls` detectado.

**Causa:** El pattern `/(\w+)\s*\(/g` no detectaba:
- `this.method()` - mÃ©todos de instancia
- `obj.method()` - mÃ©todos de objeto
- `new ClassName()` - constructores

**SoluciÃ³n:** 3 patterns de detecciÃ³n:
1. Simple calls: `functionName(`
2. Member calls: `this.method(`, `obj.method(`
3. Constructor calls: `new ClassName(`

**Resultado:** calls 22.3% â†’ **70.7%** (+218%)

### 2. Cross-File calledBy Linkage Mejorado (indexer.js)

**Problema:** Solo 22.7% de atoms tenÃ­an `calledBy` poblado.

**Causas:**
1. Lookup por nombre simple vs nombre calificado (ej: `info` vs `Logger.info`)
2. Solo consideraba `call.type === 'external'`
3. No manejaba ambigÃ¼edad cuando mÃºltiples atoms tienen el mismo nombre

**SoluciÃ³n:**
- Ãndice multi-nivel: `atomBySimpleName`, `atomByQualifiedName`, `atomByFilePath`
- Lookup inteligente: prefiere nombre calificado > exportado > archivo diferente
- Considera TODAS las llamadas: `calls`, `internalCalls`, `externalCalls`

**Resultado:** calledBy 22.7% â†’ **43.8%** (+93%)

### 3. Unified Calls en metadata-builder.js

**Cambio:** Combina `functionInfo.calls` con `callGraph.internalCalls` y `callGraph.externalCalls` en un campo unificado `calls[]`.

## ğŸ“Š Impacto Final

| MÃ©trica | Antes | DespuÃ©s | Cambio |
|---------|-------|---------|--------|
| calls | 22.3% | **70.7%** | +218% |
| calledBy | 22.7% | **43.8%** | +93% |
| Cross-file links | 1,500 | **4,245** | +183% |
| Health Score | 69.1 | **77.5** | +8.4 pts |

## ğŸ“ Archivos Modificados

- `src/layer-a-static/indexer.js` - PASO 3.6 mejorado

## ğŸ”— DocumentaciÃ³n

- `docs/audit/CROSS_FILE_LINKAGE_FIX.md` - AnÃ¡lisis detallado del problema

## ğŸ“Š Scripts de AuditorÃ­a Nuevos

- `scripts/audit-atoms-correct.js` - Auditor correcto de atoms
- `scripts/audit-deep-diagnosis.js` - DiagnÃ³stico profundo
- `scripts/audit-real-quality.js` - Calidad real de datos