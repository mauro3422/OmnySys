# v0.9.70 - SQLite Persistence Unification

**Data Integrity & Performance**: Unificación completa de la capa de persistencia en SQLite. Se eliminó el almacenamiento híbrido y la dependencia de archivos JSON para átomos y versiones, centralizando todo en una arquitectura transaccional pura.

## Key Achievements

### 1. Unified SQLite Persistence
- **JSON Elimination**: Se eliminaron las escrituras directas de archivos `.json` para átomos individuales y el archivo global `atom-versions.json`.
- **Atomic Transactions**: Implementado `saveMany` en la capa de repositorio para guardar archivos, átomos y relaciones en una sola transacción de base de datos.
- **Immediate Visibility**: La actualización de la tabla `files` ahora ocurre dentro de la misma transacción que el guardado de átomos, garantizando que herramientas como `fix_imports` vean el estado actualizado al instante.

### 2. Database-Backed Versioning
- **`atom_versions` Table**: Nueva tabla en SQLite que almacena hashes SHA-256 de átomos y campos individuales.
- **Transactional History**: El historial de cambios ahora es resistente a fallos de alimentación y cierres inesperados gracias a las propiedades ACID de SQLite.
- **Performance**: Reducción drástica del I/O de disco al eliminar operaciones síncronas de lectura/escritura de JSONs pesados.

### 3. Path & Environment Standardization
- **Uniform Path Normalization**: Todas las rutas en la base de datos se normalizan a `forward-slash` (`/`) independientemente del sistema operativo (Windows/Linux).
- **ESM Compatibility**: `AtomVersionManager` refactorizado para usar `await import` dinámico, resolviendo incompatibilidades con CommonJS en el entorno de ejecución de herramientas.

## Files Modified
- `src/layer-c-memory/storage/database/schema.sql`: Definición de la tabla `atom_versions`.
- `src/layer-c-memory/storage/database/connection.js`: Automatización de migración de esquema.
- `src/layer-c-memory/storage/atoms/atom-version-manager.js`: Migración de JSON a SQLite.
- `src/layer-c-memory/storage/atoms/incremental-atom-saver.js`: Integración con transacciones unificadas.
- `src/layer-c-memory/storage/repository/adapters/sqlite-bulk-operations.js`: Implementación de guardado atómico multichapa.
- `src/layer-c-memory/mcp/tools/atomic-edit/reindex.js`: Limpieza de hacks de persistencia manual.

## Verification Results
- **Transaction Integrity**: Confirmado que una falla en el guardado de relaciones no deja átomos huérfanos.
- **Data Consistency**: Validado que los IDs de átomos en `atom_versions` coinciden exactamente con la tabla `atoms`.
- **System Stability**: 100% de éxito en reindexaciones incrementales tras ediciones atómicas.
