# v0.9.32 - Inference Engine & LLM Bypass Optimization

**Release Date:** 2026-02-19

## ğŸ¯ Summary

Major optimization to reduce unnecessary LLM calls by implementing a new **Inference Engine** that infers patterns from static analysis before deciding if LLM is needed.

## âœ¨ New Features

### Inference Engine (`src/layer-b-semantic/inference-engine/`)

New module that extracts insights from Layer A static analysis WITHOUT using LLM:

- **Pattern Inferrer** - Detects code patterns (API, data layer, utilities, tests)
- **Relationship Analyzer** - Analyzes file relationships and neighborhoods
- **Risk Scorer** - Scores files by complexity and risk
- **Detectors**:
  - `api-detector.js` - Detects API/endpoint patterns
  - `data-layer-detector.js` - Detects storage/database patterns
  - `coupling-detector.js` - Measures coupling levels
  - `neighborhood.js` - "Society of Atoms" concept for feature detection

## ğŸ› Bug Fixes

### LLM Decision Logic (`analysis-decider.js`)

1. **MAX_LLM_PER_RUN reduced** from 150 to 20 files per run
   - Prevents runaway LLM calls

2. **ğŸ†• Incremental LLM Processing** - Solo procesa archivos modificados
   - Compara `contentHash` del index vs. hash actual del archivo
   - Skippea archivos sin cambios que ya tienen `llmInsights`
   - Log de estadÃ­sticas: `skippedUnchanged`, `skippedHasLLM`
   - Reduce I/O y evita re-procesamiento innecesario

2. **New bypass exceptions** for file types that never need LLM:
   - Type definition files (`.d.ts`, `/types/`)
   - Config files (`config`, `constant`, `.schema.json`)
   - Test files (`.test.`, `.spec.`, `/tests/`)

3. **Entry point detection** - Files with imports but no `usedBy` are recognized as valid entry points

4. **Fixed typo** `isUtilityFiles` â†’ `isUtilityFile`

## ğŸ“Š Performance Impact

| Metric | Before | After | Improvement |
|--------|--------|-------|-------------|
| LLM calls per run | Up to 150 | Max 20 | 87% reduction |
| Test files passing | 4335 | 4352 | +17 tests |
| Test suites passing | 293 | 295 | +2 suites |

## ğŸ”„ API Changes

### New Exports

```javascript
// inference-engine/index.js
export { PatternInferrer } from './pattern-inferrer.js';
export { RelationshipAnalyzer } from './relationship-analyzer.js';
export { RiskScorer } from './risk-scorer.js';
export { inferFromFile } from './infer-from-file.js';

// analysis-decider.js - new export
export { computeMetadataCompleteness } from './analysis-decider.js';
```

## ğŸ“ Files Changed

### New Files
- `src/layer-b-semantic/inference-engine/index.js`
- `src/layer-b-semantic/inference-engine/pattern-inferrer.js`
- `src/layer-b-semantic/inference-engine/relationship-analyzer.js`
- `src/layer-b-semantic/inference-engine/risk-scorer.js`
- `src/layer-b-semantic/inference-engine/infer-from-file.js`
- `src/layer-b-semantic/inference-engine/detectors/api-detector.js`
- `src/layer-b-semantic/inference-engine/detectors/data-layer-detector.js`
- `src/layer-b-semantic/inference-engine/detectors/coupling-detector.js`
- `src/layer-b-semantic/inference-engine/detectors/neighborhood.js`

### Modified Files
- `src/layer-b-semantic/llm-analyzer/analysis-decider.js`
- `src/core/orchestrator/llm-analysis.js`
- `tests/unit/layer-b-semantic/llm-analyzer/analysis-decider.test.js`
- `tests/unit/layer-b-semantic/llm-analyzer/prompt-builder.test.js`
- `package.json`

## ğŸ§ª Tests

- All 295 test files pass
- 4352 tests pass (35 skipped)
- Updated tests to reflect new LLM bypass behavior

## ğŸ“ Technical Notes

The inference engine follows the **"Society of Atoms"** principle:
- Files are like houses in a neighborhood
- If two files share imports, they're neighbors
