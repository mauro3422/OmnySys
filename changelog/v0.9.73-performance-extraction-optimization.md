# v0.9.73 - Performance: Extraction Optimization (2026-03-01)

## Resumen
Esta actualización se enfocó en optimizar la fase P4 (Atom Extraction) del pipeline, eliminando cuellos de botella asincrónicos y contención de event loop en los Worker Threads para maximizar el uso puro de CPU.

## Optimizaciones de Threads y Asincronía
- **Aumento de Paralelismo Real:** Los Worker Threads pasaron de `Math.floor(CPUs/2)` a `Math.max(1, CPUs - 2)`. En sistemas de 12 núcleos (como Ryzen 5 5600G), esto sube de 6 a 10 threads reales simultáneos, aumentando un 66% la capacidad de procesamiento de archivos en paralelo.
- **Microtask Contention Fix:** Se eliminó el `Promise.all(20)` interno de los Worker Threads. Al procesar archivos secuencialmente dentro de cada hilo, Node.js ya no sufre de context switching asíncrono ni de encolamiento de microtasks para procesos CPU-bound.
- **Batching de Hashes DB:** Se agregó `getAllFileHashes()` en las operaciones SQLite, permitiendo cargar todos los hashes en memoria al arrancar, evitando `N+1` queries en caliente durante el `processFile()`.

## Optimizaciones de Extractores
- **Warmup de Extractores (`warmExtractorCache`):** Los 8 módulos extractores ahora se pre-cargan vía dinamic import *antes* de que los workers comiencen su loop de archivos, eliminando la penalidad de I/O (cold-start) en el primer átomo extraído.
- **Synchronous Hot Path:** 
  - `extractor-runner.js` migró de `await loadExtractor()` a `getExtractorSync()`.
  - `extractDataFlow` y `extractDataFlowSafe` perdieron su firma `async` para ser completamente síncronos (aprovechando el AST reusado).
  - `semanticAnalyzer.analyzeAtom()` se hizo totalmente síncrono.
  - *Impacto:* Se eliminaron cientos de miles de `await` yields por indexación, reduciendo el ruido del Event Loop.

## Próximos Pasos Identificados
El profiling exhaustivo demostró que a pesar de optimizar la red/asincronía, el tiempo principal (57s) requiere de V8 CPU Cycles puros (Regex, Tree-sitter parsings, Allocation). La próxima evolución será separar el índice estructural rápido (Fase 1 Lazy) del análisis semántico profundo (Fase 2 Background) para llevar el tiempo de Boot Inicial a <5s.
