# v0.9.16 - Layer Cleanup: Remove Duplications

**Fecha**: 2026-02-18
**Tipo**: Refactor
**Scope**: Layer A, Layer B

## Resumen

Limpieza de código duplicado entre capas, eliminando extractores en Layer B que duplicaban funcionalidad de Layer A.

## Cambios

### Eliminados (Duplicados)

| Archivo Eliminado | Reemplazo en Layer A | Razón |
|-------------------|---------------------|-------|
| `src/layer-b-semantic/advanced-extractors.js` | `src/layer-a-static/extractors/communication/index.js` | Solo era un re-export con warning deprecated |
| `src/layer-b-semantic/redux-context-extractor/` | `src/layer-a-static/extractors/state-management/` | Duplicación completa de extractRedux/extractContext |
| `tests/unit/layer-b-semantic/redux-context-extractor/` | Tests ahora en `tests/unit/layer-a-static/extractors/state-management/` | Tests del módulo eliminado |

### No-Eliminados (Diferentes Propósitos)

| Archivo Layer B | Archivo Layer A | Razón |
|-----------------|-----------------|-------|
| `validators/extractors/storage-extractor.js` | `extractors/static/storage-extractor.js` | Layer B: simple (solo keys para validación). Layer A: detallado (reads/writes con líneas) |
| `validators/extractors/event-extractor.js` | `extractors/static/events-extractor.js` | Layer B: simple (solo nombres). Layer A: detallado (listeners/emitters) |

### Actualizaciones

- **package.json**: Eliminado script `test:layer-b:redux-context`
- **.github/workflows/ci.yml**: Eliminado `redux-context-extractor` de la matriz de tests

## Análisis de Duplicación

### Redux/Context Extractors

**Layer B** (`redux-context-extractor/`):
- 4 archivos, ~120 líneas
- `extractRedux(code)` → `{ selectors, actions, reducers, stores, thunks }`
- `extractContext(code)` → `{ contexts, providers, consumers }`

**Layer A** (`state-management/`):
- 15+ archivos, modular
- Mismas funciones + más (selectors, thunks, providers, consumers, connections)
- Más completo y mejor estructurado

**Decisión**: Mantener Layer A, eliminar Layer B

### Validators Extractors vs Static Extractors

**Layer B validators**: Simplificados, solo extraen nombres/keys para validación rápida
**Layer A static**: Detallados, extraen info completa con líneas de código

**Decisión**: Mantener ambos - diferentes niveles de abstracción para diferentes propósitos

## Arquitectura Post-Cleanup

```
src/
├── core/
│   ├── graph/              # v0.9.15: movido de layer-a
│   └── storage/            # v0.9.15: movido de layer-a
├── layer-a-static/
│   ├── extractors/
│   │   ├── communication/  # Web Workers, WebSocket, etc.
│   │   ├── state-management/  # Redux + Context (úNICO)
│   │   └── static/         # Storage, Events, Routes, etc.
│   └── ...
├── layer-b-semantic/
│   ├── validators/
│   │   └── extractors/     # Simplificados para validación
│   ├── llm-analyzer/
│   └── ...                 # Sin duplicación de extractores
└── layer-c-memory/
    └── mcp/tools/lib/analysis/
        └── call-graph-analyzer.js  # Ya usa cache de Layer A
```

## Tests

- Eliminados: 59 tests de `redux-context-extractor`
- Pendientes: Tests de `state-management` en Layer A ya cubren la funcionalidad

## Commits

```
git add -A
git commit -m "refactor(layers): remove duplicate extractors from Layer B

- Remove layer-b-semantic/advanced-extractors.js (deprecated wrapper)
- Remove layer-b-semantic/redux-context-extractor/ (duplicates layer-a)
- Remove associated tests and CI config
- Keep validators/extractors (different purpose: simplified for validation)
"
```

## Próximos Pasos

1. ✅ Eliminar `advanced-extractors.js`
2. ✅ Eliminar `redux-context-extractor/`
3. ⏭️ Verificar Layer C usa cache correctamente (ya lo hace)
4. ⏭️ Documentar arquitectura de capas en README
